%div{'ng-app' => 'registrationApp'}
  %div{'ng-controller' => 'RegistrationController as regCtrl'}
    = form_tag '', 
      'id' => 'new-account-form', 
      'name' => 'myform', 
      'qn-validate' => 'regCtrl.errors',
      'class' => 'signup' do

      %h2 Sign up
      .unknown-error

      %div{"ng-switch" => "regCtrl.nowShowing()"}
        = field_set_tag nil, "ng-switch-when" => "page1" do
          .group
            .f-row.half
              %input{'type'   => "text", 
                'placeholder' => 'First Name',
                'name' => 'first_name',
                'ng-required'    => true,
                'ng-model'    => 'regCtrl.first_name'}

            .f-row.half
              %input{'type' => "text",  
              'placeholder' => 'Last Name', 
              'ng-required'    => true,
              'ng-model'    => 'regCtrl.last_name'}

          .group
            .f-row
              %input{'type'   => "password",  
                'minLength'   => 6,
                'ng-required'    => true,
                'placeholder' => 'Password', 
                'ng-model'    =>'regCtrl.password'}

            .f-row
              %input{'type'        => "password",  
                'placeholder' => 'Confirm Password', 
                'match'       => "regCtrl.password",
                'ng-required'    => true,
                'ng-model'    => 'regCtrl.password_confirmation' }

          .group
            .f-row
              I am a
              %span.input-group
                %label{'for'=>'Student'} Student
                %input{"type" => "radio", "ng-model" => "regCtrl.registrationType", "value" => "student"}
              %span.input-group
                %label{'for'=>'Teacher'} Teacher
                %input{"type" => "radio", "ng-model" => "regCtrl.registrationType", "value" => "teacher"}
          .group
            %button#continue-registration{"ng-disabled" => "!regCtrl.readyToRegister()", "ng-click" => "regCtrl.startRegistration()"}
              Sign Up for #{APP_CONFIG[:site_name]}!
          .quote-box.bottom
            .quote "I felt like I could learn a lot by playing with the interactivesâ€
            .quote-credits - 9th grader, San Francisco, CA

        = field_set_tag nil, id: 'student-fieldset', "ng-switch-when" => "student" do
          - if current_project.allow_default_class
            .f-row
              =hidden_field_tag :class_word, Portal::Clazz.default_class.class_word, "name" => "class_word", "ng-model" => "regCtrl.class_word"
          - else
            .group
              .f-row
                = text_field_tag :class_word, nil, placeholder: 'Class Word (not case sensitive)', "name" => "class_word", "ng-model" => "regCtrl.class_word"

          - if current_project.use_student_security_questions
            .group
              %p.small
                Please select three questions from the menus below.
                If you forget your password, you will need to answer these questions correctly in order to receive a new one.
            .group
              .f-row
                %ui-select{"ng-model" => "regCtrl.questions[0]", 
                  "name" => "questions[0]",
                  "theme" =>  "select2", 
                  "style" => "width: 95%;",
                  "ui-validate" => "{unique_question: 'regCtrl.uniqueQuestions($value)'}" }
                  %ui-select-match{"placeholder" => "Choose a security question ..."}
                    {{$select.selected}}
                  %ui-select-choices{"repeat" => "question in regCtrl.security_questions" }
                    {{question}}
              .f-row
                %input{'type'   => "text", 
                  'placeholder' => 'Answer (case sensitive)',
                  'name' => 'answers[0]',
                  'ng-required'    => true,
                  'ng-model'    => 'regCtrl.answers[0]'}
            .group
              .f-row
                %ui-select{"ng-model" => "regCtrl.questions[1]", 
                  "name" => "questions[1]",
                  "theme" =>  "select2", 
                  "style" => "width: 95%;", 
                  "ui-validate" => "{unique_question: 'regCtrl.uniqueQuestions($value)'}" }
                  %ui-select-match{"placeholder" => "Choose a security question ..."}
                    {{$select.selected}}
                  %ui-select-choices{"repeat" => "question in regCtrl.security_questions" }
                    {{question}}
              .f-row
                %input{'type'   => "text", 
                  'placeholder' => 'Answer (case sensitive)',
                  'name' => 'answers[1]',
                  'ng-required'    => true,
                  'ng-model'    => 'regCtrl.answers[1]'}
            .group
              .f-row
                %ui-select{"ng-model" => "regCtrl.questions[2]", 
                  "name" => "questions[2]",
                  "theme" =>  "select2", 
                  "style" => "width: 95%;", 
                  "ui-validate" => "{unique_question: 'regCtrl.uniqueQuestions($value)'}" }
                  %ui-select-match{"placeholder" => "Choose a security question ..."}
                    {{$select.selected}}
                  %ui-select-choices{"repeat" => "question in regCtrl.security_questions" }
                    {{question}}
              .f-row
                %input{'type'   => "text", 
                  'placeholder' => 'Answer (case sensitive)',
                  'name' => 'answers[2]',
                  'ng-required'    => true,
                  'ng-model'    => 'regCtrl.answers[2]'}

          .group
            .f-row
              %button#finsish-student{"ng-disabled" => "!regCtrl.readyToSend()", "ng-click" => "regCtrl.sendRegistration()"}
                Submit

        = field_set_tag nil, id: 'teacher-fieldset', "ng-switch-when" => "teacher" do
          .group
            .f-row= text_field_tag :login, nil, placeholder: 'Username'
            .f-row= text_field_tag :email, nil, placeholder: 'E-mail'
          .group
            .f-row
              %ui-select{"ng-model"   => "regCtrl.country", 
                "theme" =>  "select2",
                "ng-change" =>  "regCtrl.countrySelected()",
                "style" =>  "width: 95%;"}
                %ui-select-match{"placeholder" => "Select your country..."}
                  {{$select.selected.name}}
                %ui-select-choices{"repeat" => "country in regCtrl.countries | filter: {name: $select.search}" }
                  {{country.name}}
          .group
            .f-row
              %ui-select{"ng-model"   => "regCtrl.state", "theme"    =>  "select2", "ng-show"  => "regCtrl.showState()", "ng-change" =>  "regCtrl.stateSelected()"}
                %ui-select-match{"placeholder" => "Select your state..."}
                  {{$select.selected}}
                %ui-select-choices{"repeat" => "state in regCtrl.states | filter: $select.search" }
                  {{state}}
          .group
            .f-row
              %ui-select{"ng-model"   => "regCtrl.district", 
                "theme"     =>  "select2",
                "ng-show"   =>  "regCtrl.showDistrict()",
                "ng-change" =>  "regCtrl.districtSelected()" }
                %ui-select-match{"placeholder" => "Select your district..."}
                  {{$select.selected.name}}
                %ui-select-choices{"repeat" => "district in regCtrl.districts | filter: {name: $select.search}" }
                  {{district.name}}
                  
          .group#school-picker{"ng-show"   => "regCtrl.showSchool()"}
            - if current_project.allow_adhoc_schools
              .f-row
                %ui-select{"ng-model" => "regCtrl.school", "theme"     =>  "select2", "style"     => "width: 95%;"}
                  %ui-select-match{"placeholder" => "Select your school ..."}
                    {{$select.selected.name}}
                  %ui-select-choices{"repeat" => "schools in regCtrl.schools | filter: {name: $select.search}" }
                    {{schools.name}}
              .f-row
                %a#cant-find-school I can't find my school in the list.
              #custom-school.group
                .f-row= text_field_tag 'school_name', nil, 'placeholder' => 'School name'
                .f-row.intl-only= text_field_tag 'province', nil, 'placeholder' => 'Province'
                .f-row.intl-only= text_field_tag 'city', nil, 'placeholder' => 'City'
                .f-row
                  %a#back-to-list  Go back to the school list.
            - else
              .f-row
                %ui-select{"ng-model" => "regCtrl.school", "theme"     =>  "select2", "style" => "width: 95%;"}
                  %ui-select-match{"placeholder" => "Select your school ..."}
                    {{$select.selected.name}}
                  %ui-select-choices{"repeat" => "schools in regCtrl.schools | filter: {name: $select.search}" }
                    {{schools.name}}

          .group
            .f-row= submit_tag 'Submit', class: 'submit-form'

      .group
        .f-row.wait-message
